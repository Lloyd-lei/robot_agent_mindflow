# 📁 项目目录结构

## 📊 最新更新（当前版本）

**更新时间**: 2025-10-25  
**更新内容**:
- ✅ 添加虚拟环境 (venv)
- ✅ 调整 ConversationSession wrapper 参数（timeout=60s, tts_wait_timeout=60s）
- ✅ 添加工具调用等待音效（sounds/tool_thinking.wav）
- ✅ 切换到 JSON 格式的 System Prompt（更适合大模型理解）

---

## 🗂️ 完整目录结构

```
agent_mvp/
│
├── 📦 核心模块
│   ├── main.py                          # 主程序入口 ⭐
│   ├── agent_hybrid.py                  # 混合架构 Agent（OpenAI + LangChain）
│   ├── conversation_session.py          # 对话会话管理器（Wrapper）
│   ├── tools.py                         # LangChain 工具定义（17个工具）
│   ├── config.py                        # 配置管理（OpenAI/Ollama 切换）
│   ├── logger_config.py                 # 日志配置
│   │
│   ├── 🗣️ TTS 相关
│   │   ├── tts_interface.py            # TTS 通用接口（Edge/OpenAI/Azure）
│   │   ├── streaming_tts_pipeline.py   # 流式 TTS 管道
│   │   ├── tts_optimizer.py            # TTS 文本优化器（批量模式）
│   │   └── voice_feedback.py           # 语音等待反馈（音效播放）⭐
│   │
│   └── 📝 Prompt 配置
│       ├── prompts/
│       │   ├── system_prompt.json      # JSON 格式 Prompt（推荐）⭐
│       │   └── README.md               # Prompt 配置说明
│
├── 🎵 资源文件
│   ├── sounds/
│   │   └── tool_thinking.wav           # 工具调用音效（23秒）⭐
│   │
│   └── test/outputs/
│       ├── openai_tts_alloy_sample.mp3
│       ├── openai_tts_echo_sample.mp3
│       ├── openai_tts_fable_sample.mp3
│       ├── openai_tts_nova_sample.mp3
│       ├── openai_tts_onyx_sample.mp3
│       ├── openai_tts_shimmer_sample.mp3 ⭐ (当前使用)
│       └── test_edge_tts.mp3
│
├── 🧪 测试文件
│   ├── test/
│   │   ├── test_session.py             # 会话管理测试
│   │   ├── test_bug_fixes.py           # Bug 修复测试
│   │   ├── test_sound_effect.py        # 音效测试 ⭐
│   │   ├── test_json_prompt.py         # JSON Prompt 测试 ⭐
│   │   ├── test_ollama.py              # Ollama 集成测试
│   │   ├── test_multilingual_voice.py  # 多语言语音测试
│   │   ├── test_openai_tts.py          # OpenAI TTS 测试
│   │   ├── test_prompt_loading.py      # Prompt 加载测试
│   │   ├── test_streaming_pipeline.py  # 流式管道测试
│   │   ├── test_tts_timestamps.py      # TTS 时间戳测试
│   │   └── ...（更多测试文件）
│   │
│   └── test_json_prompt.py             # JSON Prompt 测试（待移动）
│
├── 📚 文档
│   ├── docs/
│   │   ├── README.md                   # 文档索引
│   │   ├── ConversationSession_API.md  # Session API 文档
│   │   ├── Ollama使用指南.md           # Ollama 配置指南
│   │   ├── 项目结构说明.md             # 项目结构说明（旧版）
│   │   ├── 项目目录结构.md             # 项目目录结构（新版）⭐
│   │   ├── Wrapper更新与Bug修复总结.md # Bug 修复记录
│   │   ├── v1.1.0_更新总结.md          # 版本更新记录
│   │   └── ...（更多文档）
│   │
│   ├── README.md                        # 项目主文档 ⭐
│   └── CHANGELOG.md                     # 变更日志
│
├── 🎭 示例代码
│   └── examples/
│       ├── demo_reception.py           # 前台接待 Demo
│       └── demo_tts_showcase.py        # TTS 展示 Demo
│
├── 🗑️ 废弃文件
│   └── waste/
│       ├── agent.py                    # 旧版 Agent
│       ├── old_demos/                  # 旧版示例
│       ├── old_docs/                   # 旧版文档
│       └── old_tests/                  # 旧版测试
│
├── ⚙️ 配置文件
│   ├── .env                            # 环境变量（不提交）
│   ├── .env.example                    # 环境变量模板
│   ├── .gitignore                      # Git 忽略规则
│   ├── requirements.txt                # Python 依赖
│   └── start.sh                        # 启动脚本
│
├── 🐍 虚拟环境
│   └── venv/                           # Python 虚拟环境 ⭐
│       ├── bin/
│       ├── lib/
│       └── ...
│
└── 💾 运行时数据
    ├── sessions/                       # 会话持久化数据（.gitignore）
    ├── logs/                           # 日志文件（.gitignore）
    └── __pycache__/                    # Python 缓存（.gitignore）
```

---

## 📈 统计数据

| 类别 | 数量 | 说明 |
|------|------|------|
| **核心模块** | 12 个 | 包括 Agent、TTS、Session 等 |
| **工具函数** | 17 个 | tools.py 中定义 |
| **测试文件** | 15+ 个 | 覆盖核心功能 |
| **文档文件** | 15+ 个 | 详细的使用和开发文档 |
| **音效文件** | 1 个 | 工具调用等待音效 |
| **示例代码** | 2 个 | 前台接待、TTS 展示 |

---

## 🎯 核心文件说明

### 1️⃣ **主程序**
- `main.py`: 主入口，使用 ConversationSession wrapper
- `start.sh`: 快速启动脚本（激活 venv + 运行 main.py）

### 2️⃣ **Agent 核心**
- `agent_hybrid.py`: 混合架构（OpenAI API + LangChain 工具）
- `conversation_session.py`: 会话管理器（生命周期、超时、持久化）
- `tools.py`: 17 个 LangChain 工具

### 3️⃣ **TTS 系统**
- `tts_interface.py`: 统一 TTS 接口
- `streaming_tts_pipeline.py`: 流式 TTS 处理管道
- `voice_feedback.py`: 等待音效播放器 ⭐

### 4️⃣ **配置与日志**
- `config.py`: OpenAI/Ollama 配置切换
- `logger_config.py`: 日志系统
- `prompts/system_prompt.json`: JSON 格式的 System Prompt ⭐

---

## 🔧 最新改进

### ✅ 1. 虚拟环境 (venv)
```bash
# 创建虚拟环境
python3.12 -m venv venv

# 激活
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### ✅ 2. Session Wrapper 参数优化
```python
# conversation_session.py
with ConversationSession(
    tts_provider="openai",
    tts_voice="shimmer",
    timeout=60,           # 单轮对话超时 60s ⭐
    tts_wait_timeout=60   # TTS 播放等待 60s ⭐
) as session:
    result = session.chat(user_input)
```

### ✅ 3. 工具调用音效
```python
# voice_feedback.py
feedback = VoiceWaitingFeedback(mode='audio')

# 工具调用时播放
feedback.start('tool_thinking')  # 播放 sounds/tool_thinking.wav
# ... 执行工具 ...
feedback.stop()  # 停止音效
```

### ✅ 4. JSON Prompt（更适合大模型）
```json
{
  "identity": {
    "name": "茶茶",
    "role": "AI语音助手"
  },
  "voice_interaction_rules": {
    "response_length": { "max_chars": 100 },
    "forbidden_outputs": { ... }
  },
  "available_tools": [ ... ],
  "mandatory_rules": { ... }
}
```

优势：
- ✅ 结构化更清晰
- ✅ 便于大模型理解
- ✅ 支持嵌套和扩展
- ✅ 可程序化修改

---

## 🚀 快速开始

```bash
# 1. 激活虚拟环境并启动
./start.sh

# 或手动启动
source venv/bin/activate
python main.py
```

---

## 📝 待办事项

- [ ] 移动根目录的测试文件到 test/ 目录
- [ ] 补充更多音效文件（可选）
- [ ] 优化 JSON Prompt 加载性能
- [ ] 添加更多语言的 System Prompt 示例

---

**维护者**: AI Agent MVP Team  
**最后更新**: 2025-10-25


# 📁 项目目录结构（整理后）

> 最后更新：2025-10-25  
> 状态：✅ 已整理

## 🌳 完整目录树

```
agent_mvp/
├── 📂 核心代码 (Root Level)
│   ├── config.py                    # 🔧 配置管理（基础层）
│   ├── logger_config.py             # 📝 日志配置（基础层）
│   │
│   ├── agent_hybrid.py              # 🧠 混合架构 LLM Agent（核心层）
│   ├── conversation_session.py      # 💬 会话管理器（会话层）
│   ├── tools.py                     # 🛠️  17个工具定义（工具层）
│   │
│   ├── asr_interface.py             # 🎤 ASR 接口（语音层）
│   ├── tts_interface.py             # 🔊 TTS 接口（语音层）
│   ├── tts_optimizer.py             # ✨ TTS 文本优化（语音层）
│   ├── streaming_tts_pipeline.py    # ⚡ 流式 TTS 管道（语音层）
│   ├── vad_processor.py             # 🎙️  VAD 处理（语音层）
│   ├── audio_recorder.py            # 🎬 音频录制（语音层）
│   ├── voice_feedback.py            # 🎵 语音反馈/音效（工具层）
│   │
│   ├── main.py                      # 🚀 文本交互入口（应用层）
│   └── main_voice.py                # 🎤 语音交互入口（应用层）
│
├── 📂 配置与资源
│   ├── prompts/                     # 💬 提示词库
│   │   ├── system_prompt.json       # 系统提示词（JSON格式）
│   │   └── README.md
│   │
│   ├── sounds/                      # 🔔 音效文件
│   │   └── tool_thinking.wav        # 工具调用音效
│   │
│   ├── .env                         # 🔐 环境变量（需自己创建）
│   └── requirements.txt             # 📦 依赖列表
│
├── 📂 测试文件 (test/)
│   ├── outputs/                     # 测试输出
│   │   └── *.mp3                    # TTS 测试音频
│   │
│   ├── test_asr_interactive.py      # 🎤 ASR 交互测试（已整理）
│   ├── test_asr_simple.py           # 🎤 ASR 简单测试（已整理）
│   ├── test_microphone.py           # 🎙️  麦克风测试（已整理）
│   ├── test_vad_asr.py              # 🎤 VAD+ASR 测试（已整理）
│   │
│   ├── test_bug_fixes.py            # 🐛 Bug 修复测试
│   ├── test_config_quick.py         # ⚙️  配置快速测试
│   ├── test_detect_conversation_end.py  # 🔚 对话结束测试
│   ├── test_diagnose_issues.py      # 🔍 问题诊断测试
│   ├── test_end_conversation_filter.py  # 🔚 结束标记过滤测试
│   ├── test_final_tts_verification.py   # ✅ TTS 最终验证
│   ├── test_fixes.py                # 🔧 修复测试
│   ├── test_json_prompt.py          # 📝 JSON Prompt 测试
│   ├── test_multilingual_voice.py   # 🌍 多语言语音测试
│   ├── test_ollama.py               # 🦙 Ollama 测试
│   ├── test_openai_tts.py           # 🔊 OpenAI TTS 测试
│   ├── test_prompt_loading.py       # 📜 Prompt 加载测试
│   ├── test_session.py              # 💬 会话测试
│   ├── test_sound_effect.py         # 🎵 音效测试
│   ├── test_streaming_pipeline.py   # ⚡ 流式管道测试
│   ├── test_text_cleaner.py         # 🧹 文本清理测试
│   ├── test_tts_integration.py      # 🔗 TTS 集成测试
│   ├── test_tts_timestamps.py       # ⏱️  TTS 时间戳测试
│   └── test_voice_mode.py           # 🎤 语音模式测试
│
├── 📂 示例代码 (examples/)
│   ├── demo_reception.py            # 前台接待示例
│   └── demo_tts_showcase.py         # TTS 展示示例
│
├── 📂 文档 (docs/)
│   ├── 架构与依赖分析.md             # 🏗️  架构分析（新增）
│   ├── 项目目录结构_整理后.md        # 📁 目录结构（本文件）
│   │
│   ├── ConversationSession_API.md   # API 文档
│   ├── SESSION_PERSISTENCE_GUIDE.md # 会话持久化指南
│   ├── ASR使用指南.md               # ASR 使用指南
│   ├── Ollama使用指南.md            # Ollama 使用指南
│   ├── 多语言TTS使用指南.md         # 多语言 TTS 指南
│   │
│   ├── v1.1.0_更新总结.md           # 版本更新记录
│   ├── v1.2.0_音效与JSON_Prompt更新.md
│   ├── Wrapper更新与Bug修复总结.md
│   ├── 音频顺序和对话结束修复.md
│   ├── 修复总结.md
│   │
│   ├── TTS配置说明.md
│   ├── TTS集成总结.md
│   ├── TTS时间戳说明.md
│   ├── OpenAI_TTS_集成修复.md
│   │
│   ├── 混合架构优化报告.md
│   ├── 前台接待Agent说明.md
│   ├── U_should_know.md
│   ├── 快速开始.md
│   └── README.md
│
├── 📂 运行时文件
│   ├── logs/                        # 📝 运行日志
│   │   └── agent_YYYYMMDD.log
│   │
│   ├── sessions/                    # 💾 会话记录（保留最近3个）
│   │   └── session_*.json
│   │
│   └── temp_audio/                  # 🎤 临时音频（已清理）
│
├── 📂 废弃代码 (waste/)
│   ├── agent.py
│   ├── old_demos/
│   ├── old_docs/
│   ├── old_tests/
│   └── README.md
│
├── 📂 辅助文件
│   ├── start.sh                     # 🚀 启动脚本（文本）
│   ├── start_voice.sh               # 🎤 启动脚本（语音）
│   ├── README.md                    # 📖 项目说明
│   ├── CHANGELOG.md                 # 📝 更新日志
│   ├── ASR_README.md                # 🎤 ASR 说明
│   ├── VOICE_README.md              # 🎤 语音交互说明
│   └── 快速启动.md
│
└── 📂 虚拟环境
    └── venv/                        # 🐍 Python 虚拟环境
```

## 📊 文件统计

| 类型     | 数量   | 说明                  |
| -------- | ------ | --------------------- |
| 核心代码 | 13 个  | 根目录下的 `.py` 文件 |
| 测试文件 | 25 个  | `test/` 目录          |
| 文档文件 | 20+ 个 | `docs/` 目录          |
| 示例代码 | 2 个   | `examples/` 目录      |
| 配置文件 | 2 个   | `prompts/` 目录       |
| 音效文件 | 1 个   | `sounds/` 目录        |

## 🎯 核心模块说明

### 1. 基础层（Foundation）

- `config.py` - 配置管理（LLM、TTS、ASR 配置）
- `logger_config.py` - 统一日志系统

### 2. 语音处理层（Speech）

- `asr_interface.py` - OpenAI Whisper ASR
- `tts_interface.py` - Edge/Azure/OpenAI TTS 通用接口
- `streaming_tts_pipeline.py` - 流式 TTS 管道
- `tts_optimizer.py` - TTS 文本优化（标点、格式）
- `vad_processor.py` - VAD 语音活动检测
- `audio_recorder.py` - 实时音频录制
- `voice_feedback.py` - 语音反馈/音效播放

### 3. 核心业务层（Core）

- `agent_hybrid.py` - 混合架构 LLM Agent
  - OpenAI Native API (推理)
  - LangChain Tools (工具执行)
  - KV Cache (缓存优化)
- `tools.py` - 17 个工具定义
  - calculator, time_tool, text_analyzer, etc.

### 4. 会话层（Session）

- `conversation_session.py` - LLM + TTS 会话管理
  - 生命周期管理
  - 超时保护
  - 会话持久化

### 5. 应用层（Application）

- `main.py` - 文本交互入口
- `main_voice.py` - 语音交互入口（ASR + LLM + TTS）

## ✅ 整理成果

### 已完成

1. ✅ 移动 4 个测试文件到 `test/`
2. ✅ 清理 69 个临时音频文件
3. ✅ 清理 20 个旧会话记录（保留最近 3 个）
4. ✅ 删除废弃文件 `voice_interaction_session.py`
5. ✅ 删除临时分析脚本 `analyze_imports.py`
6. ✅ 创建架构与依赖分析文档

### 目录更清晰

- 📂 核心代码：13 个文件（根目录）
- 📂 测试代码：25 个文件（test/）
- 📂 文档：20+ 个文件（docs/）
- 📂 示例：2 个文件（examples/）
- 📂 废弃：已归档到 waste/

## 🚀 快速启动

### 文本交互

```bash
./start.sh
# 或
python main.py
```

### 语音交互

```bash
./start_voice.sh
# 或
python main_voice.py
```

## 📚 相关文档

- [架构与依赖分析](./架构与依赖分析.md)
- [ConversationSession API 文档](./ConversationSession_API.md)
- [ASR 使用指南](./ASR使用指南.md)
- [Ollama 使用指南](./Ollama使用指南.md)
- [快速开始](./快速开始.md)

## 🎯 下一步优化建议

### 短期（本周）

- [ ] 实现 Prompt RAG（向量化规则库）
- [ ] 优化语言匹配规则
- [ ] 添加更多测试用例

### 中期（下月）

- [ ] 创建 `src/` 目录，模块化重构
- [ ] 解除循环依赖
- [ ] 统一配置管理（YAML）

### 长期（季度）

- [ ] 微服务化（ASR/TTS/LLM 分离）
- [ ] 添加 REST API 接口
- [ ] Docker 容器化部署


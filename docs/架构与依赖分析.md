# ğŸ—ï¸ é¡¹ç›®æ¶æ„ä¸ä¾èµ–åˆ†æ

## ğŸ“Š æ¨¡å—ä¾èµ–å±‚çº§å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨å±‚ (Entry Points)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  main.py                     main_voice.py                   â”‚
â”‚  (æ–‡æœ¬äº¤äº’)                   (è¯­éŸ³äº¤äº’)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                            â”‚
              â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¼šè¯å±‚ (Session Layer)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  conversation_session.py     voice_interaction_session.py    â”‚
â”‚  (LLM+TTSä¼šè¯ç®¡ç†)            (å®Œæ•´è¯­éŸ³äº¤äº’ä¼šè¯)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                            â”‚
              â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒå±‚ (Core Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  agent_hybrid.py                                             â”‚
â”‚  (æ··åˆæ¶æ„Agent: OpenAI API + LangChain Tools)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å·¥å…·å±‚ (Tools Layer)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  tools.py             tts_optimizer.py                       â”‚
â”‚  (17ä¸ªå·¥å…·å®šä¹‰)        (TTSæ–‡æœ¬ä¼˜åŒ–)                          â”‚
â”‚                                                              â”‚
â”‚  voice_feedback.py                                          â”‚
â”‚  (è¯­éŸ³åé¦ˆ/éŸ³æ•ˆ)                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è¯­éŸ³å±‚ (Speech Layer)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ASR æ¨¡å—      â”‚  â”‚ TTS æ¨¡å—      â”‚  â”‚ VAD æ¨¡å—      â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚asr_interface â”‚  â”‚tts_interface â”‚  â”‚vad_processor â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚streaming_tts â”‚  â”‚audio_recorderâ”‚     â”‚
â”‚                    â”‚  _pipeline   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åŸºç¡€å±‚ (Foundation Layer)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  config.py                    logger_config.py              â”‚
â”‚  (é…ç½®ç®¡ç†)                    (æ—¥å¿—ç®¡ç†)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”— æ ¸å¿ƒæ¨¡å—ä¾èµ–å…³ç³»

### 1. åº”ç”¨å…¥å£

#### `main.py` (æ–‡æœ¬äº¤äº’)

```
main.py
â”œâ”€â”€ conversation_session
â”‚   â”œâ”€â”€ agent_hybrid
â”‚   â”‚   â”œâ”€â”€ config
â”‚   â”‚   â”œâ”€â”€ logger_config
â”‚   â”‚   â”œâ”€â”€ streaming_tts_pipeline
â”‚   â”‚   â”œâ”€â”€ tts_interface
â”‚   â”‚   â”œâ”€â”€ tts_optimizer
â”‚   â”‚   â””â”€â”€ voice_feedback
â”‚   â”œâ”€â”€ config
â”‚   â”œâ”€â”€ logger_config
â”‚   â””â”€â”€ tts_interface
â”œâ”€â”€ voice_feedback
â””â”€â”€ logger_config
```

#### `main_voice.py` (è¯­éŸ³äº¤äº’)

```
main_voice.py
â”œâ”€â”€ conversation_session (åŒä¸Š)
â”œâ”€â”€ asr_interface
â”‚   â”œâ”€â”€ config
â”‚   â””â”€â”€ logger_config
â”œâ”€â”€ voice_feedback
â”‚   â””â”€â”€ logger_config
â””â”€â”€ config
```

### 2. æ ¸å¿ƒä¸šåŠ¡æ¨¡å—

#### `agent_hybrid.py` (æœ€å¤æ‚çš„æ¨¡å—)

**ä¾èµ–ï¼š**

- `config` - é…ç½®å‚æ•°
- `logger_config` - æ—¥å¿—ç³»ç»Ÿ
- `streaming_tts_pipeline` - æµå¼ TTS ç®¡é“
- `tts_interface` - TTS æ¥å£
- `tts_optimizer` - TTS æ–‡æœ¬ä¼˜åŒ–
- `voice_feedback` - è¯­éŸ³åé¦ˆ/éŸ³æ•ˆ

**è¢«ä¾èµ–ï¼š**

- `conversation_session.py`
- `main.py`

#### `conversation_session.py` (ä¼šè¯ç®¡ç†å™¨)

**ä¾èµ–ï¼š**

- `agent_hybrid` - LLM Agent
- `tts_interface` - TTS å¼•æ“
- `config` - é…ç½®
- `logger_config` - æ—¥å¿—

**è¢«ä¾èµ–ï¼š**

- `main.py`
- `main_voice.py`
- `voice_interaction_session.py`

#### `voice_interaction_session.py` (å®Œæ•´è¯­éŸ³äº¤äº’)

**ä¾èµ–ï¼š**

- `conversation_session` - ä¼šè¯ç®¡ç†
- `asr_interface` - è¯­éŸ³è¯†åˆ«
- `audio_recorder` - éŸ³é¢‘å½•åˆ¶
- `vad_processor` - VAD å¤„ç†
- `config` - é…ç½®
- `logger_config` - æ—¥å¿—

**è¢«ä¾èµ–ï¼š** æ— ï¼ˆå·²åºŸå¼ƒï¼Œç”± `main_voice.py` æ›¿ä»£ï¼‰

### 3. è¯­éŸ³å¤„ç†æ¨¡å—

#### ASR æ¨¡å—

- `asr_interface.py` â†’ `config`, `logger_config`

#### TTS æ¨¡å—

- `tts_interface.py` â†’ æ— ä¾èµ–ï¼ˆåŸºç¡€æ¨¡å—ï¼‰
- `streaming_tts_pipeline.py` â†’ æ— æœ¬åœ°ä¾èµ–
- `tts_optimizer.py` â†’ `tts_interface`

#### VAD/å½•éŸ³æ¨¡å—

- `vad_processor.py` â†’ `logger_config`
- `audio_recorder.py` â†’ `vad_processor`, `logger_config`

### 4. å·¥å…·æ¨¡å—

- `tools.py` â†’ `tts_interface`
- `voice_feedback.py` â†’ `logger_config`

### 5. åŸºç¡€æ¨¡å—

- `config.py` â†’ æ— æœ¬åœ°ä¾èµ–
- `logger_config.py` â†’ æ— æœ¬åœ°ä¾èµ–

## ğŸ“¦ æ¨¡å—åˆ†ç±»

### æ ¸å¿ƒä¸šåŠ¡æ¨¡å— (Core)

- `agent_hybrid.py` - LLM Agent (OpenAI + LangChain)
- `conversation_session.py` - ä¼šè¯ç®¡ç†å™¨
- `tools.py` - 17 ä¸ªå·¥å…·å®šä¹‰

### è¯­éŸ³å¤„ç†æ¨¡å— (Speech)

- `asr_interface.py` - ASR æ¥å£ (OpenAI Whisper)
- `tts_interface.py` - TTS æ¥å£ (Edge/Azure/OpenAI)
- `streaming_tts_pipeline.py` - æµå¼ TTS ç®¡é“
- `tts_optimizer.py` - TTS æ–‡æœ¬ä¼˜åŒ–
- `vad_processor.py` - VAD å¤„ç† (webrtcvad)
- `audio_recorder.py` - éŸ³é¢‘å½•åˆ¶ (pyaudio)
- `voice_feedback.py` - è¯­éŸ³åé¦ˆ/éŸ³æ•ˆ (pygame)

### å·¥å…·æ¨¡å— (Utils)

- `config.py` - é…ç½®ç®¡ç†
- `logger_config.py` - æ—¥å¿—ç®¡ç†

### åº”ç”¨å…¥å£ (Apps)

- `main.py` - æ–‡æœ¬äº¤äº’å…¥å£
- `main_voice.py` - è¯­éŸ³äº¤äº’å…¥å£

### åºŸå¼ƒæ¨¡å— (Deprecated)

- `voice_interaction_session.py` - å·²è¢« `main_voice.py` æ›¿ä»£

## ğŸš¨ å½“å‰é—®é¢˜

### 1. æµ‹è¯•æ–‡ä»¶æ•£è½

- âŒ æ ¹ç›®å½•ä¸‹æœ‰ 4 ä¸ªæµ‹è¯•æ–‡ä»¶åº”è¯¥ç§»åˆ° `test/`
  - `test_asr_interactive.py`
  - `test_asr_simple.py`
  - `test_microphone.py`
  - `test_vad_asr.py`

### 2. ä¸´æ—¶æ–‡ä»¶è¿‡å¤š

- âŒ `temp_audio/` æœ‰ 69 ä¸ª WAV æ–‡ä»¶
- âŒ `sessions/` æœ‰ 23 ä¸ªä¼šè¯è®°å½•

### 3. å¾ªç¯ä¾èµ–é£é™©

- âš ï¸ `conversation_session` â†” `agent_hybrid` â†” `tts_interface` å­˜åœ¨æ½œåœ¨å¾ªç¯

### 4. æ¨¡å—èŒè´£ä¸æ¸…

- âš ï¸ `voice_interaction_session.py` å·²è¢«åºŸå¼ƒä½†ä»å­˜åœ¨

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆç«‹å³æ‰§è¡Œï¼‰

1. âœ… ç§»åŠ¨æµ‹è¯•æ–‡ä»¶åˆ° `test/`
2. âœ… æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼ˆ`temp_audio/`, `sessions/`ï¼‰
3. âœ… åˆ é™¤åºŸå¼ƒæ–‡ä»¶ `voice_interaction_session.py`

### ä¸­æœŸï¼ˆä¸‹å‘¨ï¼‰

1. åˆ›å»º `src/` ç›®å½•ï¼Œæ¨¡å—åŒ–é‡æ„
2. è§£é™¤å¾ªç¯ä¾èµ–
3. ç»Ÿä¸€é…ç½®ç®¡ç†ï¼ˆä½¿ç”¨ YAMLï¼‰

### é•¿æœŸï¼ˆä¸‹ä¸ªæœˆï¼‰

1. å®ç° Prompt RAGï¼ˆå‘é‡åŒ–è§„åˆ™åº“ï¼‰
2. å¾®æœåŠ¡åŒ–ï¼ˆASR/TTS/LLM åˆ†ç¦»ï¼‰
3. æ·»åŠ  API æ¥å£å±‚

## ğŸ“ˆ å¤æ‚åº¦åˆ†æ

| æ¨¡å—                        | ä¾èµ–æ•° | è¢«ä¾èµ–æ•° | å¤æ‚åº¦     | ä¼˜å…ˆçº§ |
| --------------------------- | ------ | -------- | ---------- | ------ |
| `config.py`                 | 0      | 7        | â­         | ğŸ”´ é«˜  |
| `logger_config.py`          | 0      | 9        | â­         | ğŸ”´ é«˜  |
| `tts_interface.py`          | 0      | 5        | â­â­       | ğŸ”´ é«˜  |
| `agent_hybrid.py`           | 6      | 2        | â­â­â­â­â­ | ğŸ”´ é«˜  |
| `conversation_session.py`   | 4      | 3        | â­â­â­â­   | ğŸ”´ é«˜  |
| `streaming_tts_pipeline.py` | 0      | 1        | â­â­â­     | ğŸŸ¡ ä¸­  |
| `asr_interface.py`          | 2      | 3        | â­â­       | ğŸŸ¡ ä¸­  |
| `vad_processor.py`          | 1      | 1        | â­         | ğŸŸ¢ ä½  |
| `voice_feedback.py`         | 1      | 2        | â­         | ğŸŸ¢ ä½  |

**è¯´æ˜ï¼š**

- **ä¾èµ–æ•°**ï¼šè¯¥æ¨¡å—ä¾èµ–å¤šå°‘å…¶ä»–æ¨¡å—
- **è¢«ä¾èµ–æ•°**ï¼šæœ‰å¤šå°‘æ¨¡å—ä¾èµ–è¯¥æ¨¡å—
- **å¤æ‚åº¦**ï¼šç»¼åˆè¯„ä¼°ï¼ˆâ­ = ä½ï¼Œâ­â­â­â­â­ = é«˜ï¼‰
- **ä¼˜å…ˆçº§**ï¼šä¿®æ”¹æ—¶çš„é£é™©ç­‰çº§


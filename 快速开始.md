# 🚀 快速开始

## 5 分钟上手 AI Agent + TTS

---

## 第 1 步：克隆项目

```bash
git clone https://github.com/Lloyd-lei/robot_agent_mindflow.git
cd robot_agent_mindflow
```

---

## 第 2 步：配置环境

### 2.1 创建虚拟环境（推荐）

```bash
python -m venv venv
source venv/bin/activate  # Mac/Linux
# 或 venv\Scripts\activate  # Windows
```

### 2.2 安装依赖

```bash
pip install -r requirements.txt
```

安装包括：

- ✅ OpenAI SDK
- ✅ LangChain
- ✅ Edge TTS（语音合成）
- ✅ pygame（音频播放）

---

## 第 3 步：配置 API 密钥

### 3.1 复制配置模板

```bash
cp .env.example .env
```

### 3.2 编辑 `.env` 文件

```bash
# 使用你喜欢的编辑器
nano .env
# 或
vim .env
# 或
code .env  # VS Code
```

### 3.3 填入你的 OpenAI API 密钥

```env
# OpenAI API 配置
OPENAI_API_KEY=sk-proj-你的密钥

# LLM 模型配置
LLM_MODEL=gpt-4-turbo-preview
TEMPERATURE=0
```

💡 **没有 API 密钥？**

1. 访问：https://platform.openai.com/api-keys
2. 创建新的 API 密钥
3. 复制并粘贴到 `.env` 文件

---

## 第 4 步：测试 TTS

```bash
python test_tts_integration.py
```

**期望输出：**

```
🧪 测试 Edge TTS 集成
1️⃣  创建 Edge TTS 实例...
   ✅ 成功！

2️⃣  合成测试文本...
   ✅ 合成成功！音频大小: 21,888 字节

4️⃣  使用 pygame 播放音频...
   🔊 正在播放...
   ✅ 播放完成！
```

如果听到"你好，这是 Edge TTS 集成测试"，说明 TTS 工作正常！✅

---

## 第 5 步：运行 AI Agent

```bash
python demo_hybrid.py
```

**期望输出：**

```
🚀 混合架构AI Agent - 性能优化版
===============================================
✨ 核心优势：
  📊 OpenAI原生API - 100%可靠的工具调用
  🛠️  LangChain工具池 - 17个强大工具
  ⚡ KV Cache优化 - 多轮对话速度提升3-5倍
  💰 Prompt Caching - 成本节省50%

⏳ 正在初始化混合架构Agent...
🎵 使用 Edge TTS（晓晓语音）...
✅ 混合架构Agent初始化成功
   TTS优化: 启用
   语音模式: 启用

💬 您:
```

---

## 🎯 试试这些命令

### 基础功能

```
现在几点了？
```

```
计算 sqrt(2) 保留 3 位小数
```

```
统计'人工智能'有多少字？
```

### 高级功能

```
图书馆有关于 Python 的书吗？
```

```
明天上午10点提醒我开会
```

```
搜索最新的 AI 新闻
```

### 前台接待功能

```
帮我登记访客信息
```

```
查询会议室使用情况
```

```
告诉我洗手间怎么走
```

### 结束对话

```
再见
```

Agent 会自动检测结束意图并优雅退出！✨

---

## 📊 查看系统统计

在对话中输入：

```
stats
```

会显示 KV Cache 统计信息：

```
📊 KV Cache 统计信息
对话轮次: 5
总消息数: 12
缓存tokens: ~2,500 tokens
💰 预估节省: ~1,250 tokens 成本
```

---

## 🎵 TTS 演示效果

当你提问时，Agent 会：

1. 🤔 **显示思考状态**

   ```
   🤔 Agent正在思考...
   ```

2. 📊 **展示推理过程**

   ```
   ✅ 模型决策:
      → 选择工具: calculator
   📥 模型决定的参数:
      { "expression": "sqrt(2)" }
   📤 工具返回结果:
      1.414
   ```

3. 📝 **显示 LLM 原始输出**

   ```
   计算结果是：1.414
   ```

4. 🗣️ **显示 TTS 优化结构**

   ```
   [Chunk 0]
     文本: 计算结果是：1.
     长度: 8 字符
     停顿: 800ms

   [Chunk 1]
     文本: 414。
     长度: 4 字符
     停顿: 800ms
   ```

5. 🔊 **播放语音**（如果你有扬声器）

---

## 🛠️ 常用命令

| 命令          | 功能         |
| ------------- | ------------ |
| `help`        | 查看帮助     |
| `stats`       | 查看缓存统计 |
| `clear`       | 清除对话历史 |
| `q` 或 `quit` | 退出程序     |

---

## ⚠️ 常见问题

### 问题 1：API 密钥错误

```
❌ 请在 .env 文件中设置 OPENAI_API_KEY 环境变量
```

**解决方法：**

1. 检查 `.env` 文件是否存在
2. 确认 API 密钥正确
3. 确保没有多余的空格或引号

---

### 问题 2：TTS 播放无声音

**可能原因：**

- 音量被静音
- 扬声器未连接
- pygame 音频初始化失败

**解决方法：**

1. 检查系统音量
2. 尝试播放其他音频
3. 重新安装 pygame：`pip install --upgrade pygame`

---

### 问题 3：网络连接错误

```
❌ Error: Connection timeout
```

**解决方法：**

- 检查网络连接
- 检查防火墙设置
- TTS 需要访问微软服务器
- OpenAI API 需要国际网络

---

### 问题 4：依赖冲突

```
ERROR: pip's dependency resolver...
```

**解决方法：**

```bash
# 使用虚拟环境（推荐）
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 或强制重新安装
pip install --force-reinstall -r requirements.txt
```

---

## 📚 进阶阅读

### 了解更多功能

- 📖 `TTS配置说明.md` - TTS 详细配置
- 📖 `项目结构说明.md` - 项目架构
- 📖 `混合架构优化报告.md` - 性能优化
- 📖 `前台接待Agent说明.md` - 业务场景

### 自定义开发

- 🔧 `tools.py` - 添加自定义工具
- 🔧 `tts_interface.py` - 集成其他 TTS
- 🔧 `agent_hybrid.py` - 修改 Agent 行为

### 测试脚本

- 🧪 `test_tts_integration.py` - TTS 功能测试
- 🧪 `test_hybrid_vs_langchain.py` - 性能对比

---

## 🎯 下一步

### 1️⃣ 切换 TTS 语音

```python
from agent_hybrid import HybridReasoningAgent
from tts_interface import TTSFactory, TTSProvider

# 使用男声
tts = TTSFactory.create_tts(
    provider=TTSProvider.EDGE,
    voice="zh-CN-YunxiNeural",  # 云希男声
    rate="+10%"                 # 加快语速
)

agent = HybridReasoningAgent(
    enable_tts=True,
    tts_engine=tts
)
```

### 2️⃣ 添加自定义工具

编辑 `tools.py`：

```python
from langchain.tools import BaseTool

class MyCustomTool(BaseTool):
    name = "my_tool"
    description = "我的自定义工具"

    def _run(self, query: str) -> str:
        # 你的逻辑
        return "结果"
```

然后在 `agent_hybrid.py` 中注册：

```python
from tools import MyCustomTool

def _init_langchain_tools(self):
    return [
        # ... 其他工具
        MyCustomTool()
    ]
```

### 3️⃣ 部署到生产环境

考虑切换到 Azure TTS：

```python
tts = TTSFactory.create_tts(
    provider=TTSProvider.AZURE,
    api_key=os.getenv("AZURE_SPEECH_KEY"),
    region="eastasia"
)
```

---

## 🆘 需要帮助？

- 📧 提交 Issue：https://github.com/Lloyd-lei/robot_agent_mindflow/issues
- 📖 查看文档：仓库中的 `.md` 文件
- 🔍 搜索代码：所有代码都有详细注释

---

## ✅ 快速检查清单

完成以下步骤，确保一切正常：

- [ ] ✅ 克隆项目
- [ ] ✅ 安装依赖（`pip install -r requirements.txt`）
- [ ] ✅ 配置 API 密钥（`.env` 文件）
- [ ] ✅ 测试 TTS（`python test_tts_integration.py`）
- [ ] ✅ 运行 Agent（`python demo_hybrid.py`）
- [ ] ✅ 尝试对话（"现在几点了？"）
- [ ] ✅ 听到语音回复

全部完成？🎉 **恭喜！你已经成功运行了 AI Agent + TTS！**

---

**享受你的 AI 语音助手吧！** 🚀🎉

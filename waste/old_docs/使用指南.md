# 🚀 多模态 AI Agent MVP - 使用指南

## 项目已完成 ✅

恭喜！您的**具有推理能力和自主函数调用的 LLM 架构**已经搭建完成！

---

## 📋 项目概述

本项目实现了一个**解耦设计的 AI Agent**，核心特性包括：

✅ **推理能力** - LLM 能够理解问题并进行推理  
✅ **自主函数调用** - LLM 自主决策何时调用工具  
✅ **解耦架构** - LLM 与工具完全分离，易于扩展  
✅ **已验证功能** - 成功计算 sqrt(2)保留 3 位小数 = 1.414

---

## 🎯 核心测试完成

### 测试结果：全部通过 ✅

```
测试1: 计算sqrt(2)保留3位小数 ✅
  LLM推理流程：
  1. 理解需求：需要计算2的平方根并保留3位小数
  2. 决策：这是数学计算，需要使用calculator工具
  3. 调用工具：calculator("round(sqrt(2), 3)")
  4. 获取结果：1.414
  5. 生成答案：计算结果是1.414

测试2: 复杂运算 ✅
  输入：(3+5)*2-1等于多少
  输出：15

测试3: 普通对话 ✅
  输入：你好
  输出：你好！有什么可以帮助你的吗？
  （LLM正确判断不需要工具）

测试4: 数学常量 ✅
  输入：计算sin(pi/2)的值
  输出：1.0
```

---

## 📁 项目结构

```
agent_mvp/
├── config.py           # 配置管理（包含API Key）
├── tools.py            # 工具模块（计算器工具）
├── agent.py            # Agent核心（推理引擎）
├── test_agent.py       # 完整测试脚本
├── simple_test.py      # 快速测试脚本
├── demo.py            # 交互式演示
├── requirements.txt    # 依赖列表
├── README.md          # 项目文档
└── 使用指南.md        # 本文件
```

---

## 🎮 快速开始

### 1. 快速测试（推荐）

验证核心功能：

```bash
python simple_test.py
```

**预期输出：**

```
✅ 测试通过！
   答案: 计算 \(\sqrt{2}\) 并保留3位小数的结果是 1.414。
```

### 2. 完整测试

运行所有测试场景：

```bash
python test_agent.py
```

**包含测试：**

- sqrt(2)计算（多种表达方式）
- 复杂数学运算
- 普通对话
- 数学常量使用

### 3. 交互式体验

与 Agent 实时对话：

```bash
python demo.py
```

**可以尝试：**

- "计算 sqrt(2)保留 3 位小数"
- "(10+5)\*3 是多少"
- "你好"
- "计算 sin(pi/2)"

---

## 🛠️ 直接使用 Agent

### Python 代码示例

```python
from agent import ReasoningAgent

# 1. 创建Agent实例
agent = ReasoningAgent(verbose=True)

# 2. 执行推理和工具调用
result = agent.run("计算sqrt(2)保留3位小数")

# 3. 获取结果
print(result['output'])
# 输出: 计算 \(\sqrt{2}\) 并保留3位小数的结果是 1.414。
```

### 调整参数

```python
# 显示详细推理过程
agent = ReasoningAgent(verbose=True)

# 隐藏推理过程，只看结果
agent = ReasoningAgent(verbose=False)

# 使用不同的模型
agent = ReasoningAgent(model="gpt-4")

# 调整温度（0-1，越低越确定）
agent = ReasoningAgent(temperature=0.7)
```

---

## 🔧 核心组件说明

### 1. CalculatorTool（计算器工具）

**位置：** `tools.py`

**功能：**

- 基础运算：`+`, `-`, `*`, `/`, `**`
- 数学函数：`sqrt`, `sin`, `cos`, `tan`, `log`, `exp`, `abs`, `round`
- 数学常量：`pi`, `e`

**直接使用：**

```python
from tools import CalculatorTool

calc = CalculatorTool()
result = calc._run("round(sqrt(2), 3)")
print(result)  # 输出: 1.414
```

### 2. ReasoningAgent（推理 Agent）

**位置：** `agent.py`

**架构：**

```
用户输入
   ↓
Agent编排层（决策中心）
   ↓
LLM推理（GPT-4）
   ↓
工具调用（Calculator等）
   ↓
结果综合
   ↓
最终答案
```

**工作流程：**

1. **Think（思考）**: LLM 分析问题
2. **Decide（决策）**: LLM 判断是否需要工具
3. **Act（行动）**: LLM 调用工具并传参
4. **Observe（观察）**: LLM 理解工具返回结果
5. **Respond（回答）**: LLM 生成最终答案

---

## 🎓 架构亮点

### 1. 解耦设计

```python
┌──────────┐         ┌──────────┐
│   LLM    │ ◄────► │  Tools   │
│ (推理)   │         │ (执行)   │
└──────────┘         └──────────┘
```

**优势：**

- LLM 可以换成任何模型（GPT-4、Claude、国产模型）
- 工具可以独立升级和维护
- 新工具可以即插即用

### 2. 自主函数调用

LLM 自己决定：

- **何时**调用工具（需要时才调用）
- **调用哪个**工具（从多个工具中选择）
- **传什么参数**（自动构造正确的参数）

### 3. ReAct 推理模式

基于论文：[ReAct: Synergizing Reasoning and Acting in Language Models](https://arxiv.org/abs/2210.03629)

**优势：**

- 多步推理能力
- 自我纠错能力
- 可解释性强

---

## 🚀 扩展方向

### 添加新工具非常简单

**示例：添加天气查询工具**

```python
# 1. 在 tools.py 中定义新工具
from langchain.tools import BaseTool
from pydantic import BaseModel, Field

class WeatherInput(BaseModel):
    city: str = Field(description="城市名称")

class WeatherTool(BaseTool):
    name = "weather"
    description = "查询指定城市的天气"
    args_schema = WeatherInput

    def _run(self, city: str) -> str:
        # 实现天气查询逻辑
        return f"{city}的天气是晴天"

# 2. 在 agent.py 的 _init_tools() 中添加
def _init_tools(self):
    return [
        CalculatorTool(),
        WeatherTool(),  # 新工具！
    ]

# 3. 完成！LLM会自动学会使用
agent = ReasoningAgent()
result = agent.run("北京天气怎么样？")
# LLM会自动调用weather工具！
```

### 未来可以添加的工具

1. **图像识别工具** - 集成 GPT-4V 或其他视觉模型
2. **网络搜索工具** - 集成搜索引擎 API
3. **数据库查询工具** - 执行 SQL 查询
4. **文件操作工具** - 读写文件
5. **API 调用工具** - 调用第三方服务

---

## 📊 API 密钥配置

当前 API 密钥已硬编码在 `config.py` 中。

如果需要更换，有两种方式：

### 方式 1：修改 config.py

```python
# config.py 第8行
OPENAI_API_KEY = "你的新API密钥"
```

### 方式 2：使用环境变量

```bash
# 创建 .env 文件
echo "OPENAI_API_KEY=你的新API密钥" > .env

# Python会自动读取
```

---

## ⚙️ 配置说明

### config.py 参数

```python
OPENAI_API_KEY = "..."          # OpenAI API密钥
LLM_MODEL = "gpt-4-turbo-preview"  # 使用的模型
TEMPERATURE = 0                    # 温度（0=最确定性）
```

### 模型选择建议

| 模型                | 推理能力   | 速度       | 成本     | 推荐场景         |
| ------------------- | ---------- | ---------- | -------- | ---------------- |
| gpt-4-turbo-preview | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐   | ⭐⭐⭐   | 生产环境（推荐） |
| gpt-4               | ⭐⭐⭐⭐⭐ | ⭐⭐⭐     | ⭐⭐⭐⭐ | 高质量需求       |
| gpt-3.5-turbo       | ⭐⭐⭐     | ⭐⭐⭐⭐⭐ | ⭐       | 快速测试         |

---

## 🐛 常见问题

### Q1: 依赖安装失败？

```bash
# 方案1：升级pip
pip install --upgrade pip

# 方案2：使用国内镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q2: API 调用失败？

**检查：**

1. API 密钥是否正确
2. 网络连接是否正常
3. API 额度是否充足

### Q3: 如何看到详细的推理过程？

```python
# 设置 verbose=True
agent = ReasoningAgent(verbose=True)
```

### Q4: 如何让 Agent 更"确定"？

```python
# 设置 temperature=0（完全确定）
agent = ReasoningAgent(temperature=0)
```

---

## 📚 技术参考

### 使用的框架和库

- **LangChain** - Agent 框架

  - 官网: https://python.langchain.com/
  - 文档: https://python.langchain.com/docs/get_started/introduction

- **OpenAI API** - LLM 服务
  - 官网: https://platform.openai.com/
  - 文档: https://platform.openai.com/docs

### 推荐阅读

1. **ReAct 论文** - https://arxiv.org/abs/2210.03629
2. **LangChain Agents 指南** - https://python.langchain.com/docs/modules/agents/
3. **OpenAI Function Calling** - https://platform.openai.com/docs/guides/function-calling

---

## 💡 下一步建议

### 立即可以做的：

1. ✅ **体验交互模式**

   ```bash
   python demo.py
   ```

2. ✅ **尝试不同的计算**

   - 复杂数学表达式
   - 多步计算
   - 边界情况测试

3. ✅ **添加新工具**
   - 参考上面的"扩展方向"
   - 从简单工具开始

### 进阶方向：

1. **添加图像识别** - 实现多模态能力
2. **添加记忆系统** - 实现多轮对话
3. **集成向量数据库** - 实现 RAG 检索增强
4. **部署为 API 服务** - 使用 FastAPI 暴露接口
5. **构建 Web 界面** - 使用 React/Vue 创建前端

---

## 🎉 总结

您已成功搭建了一个：

✅ **具有推理能力的 LLM Agent**  
✅ **支持自主函数调用**  
✅ **解耦的可扩展架构**  
✅ **完整的测试验证**

**核心验证：**

- sqrt(2) 保留 3 位小数 = 1.414 ✅
- LLM 能够自主决策调用工具 ✅
- 架构清晰，易于扩展 ✅

---

## 📞 支持

如有问题，请查看：

1. `README.md` - 完整文档
2. `test_agent.py` - 测试示例
3. `demo.py` - 使用示例

---

**祝您使用愉快！🚀**

_Version: 1.0.0_  
_Last Updated: 2025-10-23_
